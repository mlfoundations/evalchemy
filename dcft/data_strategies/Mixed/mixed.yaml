name: mix_banana_ray
dataset_mix:
  -
    name: evol_instruct
  -
    name: shp
    operators:
      - id: load_shp
        config:
          type: hf_source
          dataset: stanfordnlp/SHP
          split: train
          columns: 
            - history
            - human_ref_A
          num_truncate: 5

      - id: instruction_generation
        config:
          type: function
          sharded: true
          function: data_strategies.WizardLM.utils.instruction_generation
          function_config:
            input_column: history
            output_column: evol_instruction
        input_ids:
          - load_shp
        
      - id: dedup_evol_instructions
        config:
          type: function
          function: data_strategies.WizardLM.utils.dedup
          function_config:
            input_column: evol_instruction
        input_ids:
          - instruction_generation

      - id: annotate
        config:
          type: function
          sharded: true
          function: data_strategies.WizardLM.utils.annotate
          function_config:
            input_column: evol_instruction
            output_column: completion
        input_ids:
          - dedup_evol_instructions

      - id: rename_prompt
        config:
          type: function
          sharded: true
          function: data_strategies.WizardLM.utils.force_rename_column
          function_config:
            old_name: evol_instruction
            new_name: prompt
        input_ids:
          - annotate

      - id: remove_other_columns
        config:
          type: function
          sharded: true
          function: data_strategies.WizardLM.utils.remove_other_columns
          function_config:
            columns_to_keep:
                - prompt
                - completion
        input_ids:
          - rename_prompt